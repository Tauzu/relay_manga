{% load static %}
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=10.0, user-scalable=yes">
    <title>マンガをえがく</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{% static 'manga/manga_editor.css' %}">
</head>
<body data-parent-id="{% if parent %}{{ parent.id }}{% endif %}" data-manga-id="{{ manga.id }}">

<div class="editor-container">
    <!-- ツールバー -->
    <div class="toolbar">
        <!-- ステップ1: コマ割り選択 -->
        <div class="tool-section" id="step1-section">
            <label class="font-semibold">コマ割り:</label>
            <select id="panel-rows" class="border rounded px-2 py-1">
                <option value="1" selected>1段</option>
                <option value="2">2段</option>
                <option value="3">3段</option>
            </select>
            <span>×</span>
            <select id="panel-cols" class="border rounded px-2 py-1">
                <option value="1" selected>1列</option>
                <option value="2">2列</option>
                <option value="3">3列</option>
            </select>
            <button id="apply-panels" class="tool-btn btn-primary">決定</button>
        </div>
        
        <!-- ステップ2: 描画ツール -->
        <div class="tool-section" id="step2-section" style="display: none;">
            <button id="tool-pencil" class="tool-btn active">✏️ 鉛筆</button>
            <button id="tool-eraser" class="tool-btn">🧹 消しゴム</button>
            <button id="tool-text" class="tool-btn">📝 テキスト</button>
        </div>
        
        <div class="tool-section" id="brush-size-section" style="display: none;">
            <label class="text-sm">太さ:</label>
            <input id="brush-size" type="range" min="1" max="20" value="3" class="w-20">
            <span id="brush-size-value" class="text-sm">3</span>
        </div>
        
        <div class="tool-section" id="font-size-section" style="display: none;">
            <label class="text-sm">文字:</label>
            <input id="font-size" type="range" min="12" max="60" value="20" class="w-20">
            <span id="font-size-value" class="text-sm">20</span>
        </div>
        
        <div class="tool-section" id="history-section" style="display: none;">
            <button id="undo-btn" class="tool-btn" disabled>↶ Undo</button>
            <button id="redo-btn" class="tool-btn" disabled>↷ Redo</button>
        </div>
        
        <div class="tool-section" id="action-section" style="display: none;">
            <button id="clear-canvas" class="tool-btn">🗑️ クリア</button>
            <button id="save-image" class="tool-btn btn-success">✅ 完成</button>
        </div>
        
        <!-- スペーサー -->
        <div class="spacer"></div>
        
        <div class="tool-section">
            <button id="back-btn" class="tool-btn">← 戻る</button>
        </div>
    </div>
    
    <!-- キャンバス -->
    <div class="canvas-wrapper">
        <div id="canvas-container" style="position: relative; display: inline-block;">
            <canvas id="manga-canvas" width="800" height="800"></canvas>
        </div>
    </div>
</div>

<!-- テキスト入力オーバーレイ -->
<div id="text-input-overlay" class="text-input-overlay">
    <div class="text-input-box">
        <h3 class="text-lg font-bold mb-3">テキストを入力</h3>
        <textarea id="text-content" class="w-full border rounded p-2 mb-3" rows="3" 
                  placeholder="セリフを入力してください"></textarea>
        <div class="mb-3">
            <label class="text-sm font-semibold">フォントサイズ:</label>
            <input id="text-font-size" type="range" min="12" max="60" value="20" class="w-full">
            <span id="text-font-size-value" class="text-sm">20px</span>
        </div>
        <div class="flex gap-2 justify-end">
            <button id="text-cancel" class="px-4 py-2 border rounded">キャンセル</button>
            <button id="text-ok" class="px-4 py-2 bg-blue-500 text-white rounded">OK</button>
        </div>
    </div>
</div>

<script src="{% static 'manga/manga_editor.js' %}"></script>
</body>
</html>