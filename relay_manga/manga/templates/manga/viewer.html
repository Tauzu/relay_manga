{% extends "base.html" %}
{% load static %}

{% block title %}{{ manga.title }} Viewer{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto bg-white rounded-lg shadow p-6 relative">

    <!-- üè∑ „Çø„Ç§„Éà„É´ÈÉ®ÂàÜ -->
    <div class="mb-6 text-lg text-gray-800 font-semibold">
        <span class="cursor-pointer hover:underline"
            onclick="window.location.href='{% url 'manga_detail' manga.id %}'">
        {{ manga.title }}
        </span>
        &gt;
        <span id="viewer-title">{{ first_page.display_title }}</span>
        <span class="text-gray-500 text-sm">(ID: <span id="viewer-id">{{ first_page.id }}</span>)</span>
    </div>

    <!-- üìÑ ÁîªÂÉèË°®Á§∫„Ç®„É™„Ç¢ -->
    <div class="relative flex items-center justify-center">
        <!-- Â∑¶Áü¢Âç∞ -->
        <button id="prev-btn"
                class="absolute left-0 ml-4 bg-gray-100 enabled:hover:bg-gray-200 rounded-full p-3 shadow transition disabled:opacity-40"
                title="Ââç„ÅÆ„Éö„Éº„Ç∏„Å∏">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
            </svg>
        </button>

        <!-- ÁîªÂÉè -->
        <img id="viewer-image"
            src="{{ first_page.image.url|default_if_none:'' }}"
            alt="Page image"
            class="object-contain w-[600px] h-[600px] border rounded shadow-md transition-all duration-500 ease-in-out opacity-100" />

        <!-- Âè≥Áü¢Âç∞ÔºÜÂàÜÂ≤ê„Éú„Çø„É≥ -->
        <div class="absolute right-0 mr-4 flex flex-col items-center">
            <button id="next-btn"
                    class="bg-gray-100 enabled:hover:bg-gray-200 rounded-full p-3 shadow transition disabled:opacity-40"
                    title="Ê¨°„ÅÆ„Éö„Éº„Ç∏„Å∏">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                </svg>
            </button>

            <!-- ... ÂàÜÂ≤ê„É°„Éã„É•„Éº -->
            <div class="relative mt-2">
                <button id="branch-toggle"
                        class="bg-gray-100 hover:bg-gray-200 rounded-full p-2 shadow transition"
                        title="ÂàÜÂ≤ê„ÇíÈÅ∏Êäû">‚Ä¶</button>
                <div id="branch-menu"
                    class="absolute right-0 mt-2 bg-white border rounded shadow-md hidden w-64 z-10"></div>
            </div>
        </div>
    </div>

    <!-- ‚ù§Ô∏è „ÅÑ„ÅÑ„Å≠„Éú„Çø„É≥ Ôºã Á∂ö„Åç„ÇíÊèè„Åè -->
    <div class="flex justify-center items-center gap-4 mt-6">
        <form id="like-form" method="post">
            {% csrf_token %}
            <button type="submit" id="like-button"
                class="flex items-center gap-2 px-6 py-2 rounded-lg bg-blue-500 text-white font-semibold hover:bg-blue-600 transition disabled:bg-gray-400">
                üëç „ÅÑ„ÅÑ„Å≠
            </button>
        </form>

        <span class="text-gray-700 text-lg flex items-center gap-1">
            ‚ù§Ô∏è <span id="like-count">{{ first_page.likes }}</span>
        </span>

        <!-- ‚úèÔ∏è Á∂ö„Åç„ÇíÊèè„Åè„Éú„Çø„É≥ -->
        <a id="continue-link"
        href="{% url 'continue_page' first_page.id %}"
        class="flex items-center gap-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600 transition">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
            </svg>
            Á∂ö„Åç„ÇíÊèè„Åè
        </a>
    </div>
</div>

<!-- üîπ „Éö„Éº„Ç∏„Éá„Éº„Çø„ÇíÊ∏°„Åô -->
<script>
    window.viewerPages = {{ pages_json|safe }};
    window.initialIndex = {{ current_index }};
</script>

<!-- JS Ë™≠„ÅøËæº„Åø -->
<script src="{% static 'manga/viewer.js' %}"></script>
{% endblock %}
