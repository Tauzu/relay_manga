<!DOCTYPE html>
<html>
<head>
    <title>{{ page.manga.title }} - Page {{ page.id }}</title>
</head>
<body>
    <h1>{{ page.manga.title }} - Page {{ page.id }}</h1>
    <p>Author: {{ page.author.username }}</p>
    <p>ä½œæˆæ—¥æ™‚: {{ page.created_at }}</p>
    <div>
        <img src="{{ page.image.url }}" alt="Page image" style="max-width:80%; border:1px solid #ccc;">
    </div>

    <p>ã„ã„ã­æ•°: <span id="like-count">{{ page.likes }}</span></p>

    <form id="like-form" method="post" action="{% url 'like_page' page.id %}">
        {% csrf_token %}
        <button type="submit" id="like-button"
            {% if liked %}disabled{% endif %}>
            {% if liked %}ğŸ‘ ã„ã„ã­æ¸ˆã¿{% else %}ğŸ‘ ã„ã„ã­{% endif %}
        </button>
    </form>

    <script>
    document.getElementById("like-form").addEventListener("submit", function(event) {
        event.preventDefault();
        fetch(this.action, {
            method: "POST",
            headers: {
                "X-CSRFToken": "{{ csrf_token }}",
                "X-Requested-With": "XMLHttpRequest"
            }
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("like-count").innerText = data.likes;
            if (data.already) {
                document.getElementById("like-button").disabled = true;
                document.getElementById("like-button").innerText = "ğŸ‘ ã„ã„ã­æ¸ˆã¿";
            }
        });
    });
    </script>

    <hr>

    {% if parent %}
        <p><a href="{% url 'page_detail' parent.id %}">â† å‰ã®ãƒšãƒ¼ã‚¸ã¸ (Page {{ parent.id }})</a></p>
    {% endif %}

    {% if next_page %}
        <p><a href="{% url 'page_detail' next_page.id %}">æ¬¡ã®ãƒšãƒ¼ã‚¸ã¸ (Page {{ next_page.id }}) â†’</a></p>
    {% endif %}

    <hr>

    <h3>ã“ã®ãƒšãƒ¼ã‚¸ã®åˆ†å²å…ˆ</h3>
    <ul>
        {% for child in children %}
            <li>
                <a href="{% url 'page_detail' child.id %}">
                    Page {{ child.id }} by {{ child.author.username }} (å„ªå…ˆåº¦: {{ child.priority }})
                </a>
            </li>
        {% empty %}
            <li>åˆ†å²ã¯ã¾ã ã‚ã‚Šã¾ã›ã‚“ã€‚</li>
        {% endfor %}
    </ul>

    <p>
        <a href="{% url 'continue_page' page.id %}">ã“ã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ç¶šãã‚’æã</a>
    </p>
    <p>
        <a href="{% url 'manga_detail' page.manga.id %}">â† ãƒãƒ³ã‚¬ã«æˆ»ã‚‹</a>
    </p>
</body>
</html>
