{% extends "base.html" %}
{% load static %}

{% block title %}{{ manga.title }}{% endblock %}

{% block content %}
<style>
    /* èƒŒæ™¯è¨­å®š */
    body {
        {% if manga.cover_image %}
            background-image: url("{{ manga.cover_image.url }}");
        {% else %}
            background: linear-gradient(to bottom right, #f9fafb, #e5e7eb);
        {% endif %}
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
    }

    /* èƒŒæ™¯ã®ä¸Šã«ç™½ã„ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã‚’ã‹ã‘ã¦èª­ã¿ã‚„ã™ã */
    .content-overlay {
        background-color: rgba(255, 255, 255, 0.85);
        border-radius: 1rem;
        padding: 2rem;
        backdrop-filter: blur(6px);
    }
</style>

<div class="max-w-5xl mx-auto content-overlay">

    <!-- ğŸ· ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-3xl font-bold text-gray-900">{{ manga.title }}</h2>
    </div>

    <!-- âœ… æœ€åˆã®ãƒšãƒ¼ã‚¸è¿½åŠ ãƒœã‚¿ãƒ³ -->
    {% if manga.pages.count == 0 %}
        <div class="mb-6">
            <a href="{% url 'create_page' manga.id %}" 
               class="inline-flex items-center gap-2 px-4 py-2 rounded bg-green-500 text-white hover:bg-green-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                ã“ã®ãƒãƒ³ã‚¬ã«æœ€åˆã®ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ ã™ã‚‹
            </a>
        </div>
    {% endif %}

    <!-- ğŸ§© ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ -->
    <div id="network" class="w-full h-[600px] border border-gray-300 rounded bg-white/70"></div>

    <!-- ğŸ”™ æˆ»ã‚‹ãƒªãƒ³ã‚¯ -->
    <p class="mt-6">
        <a href="{% url 'manga_list' %}" class="text-gray-600 hover:underline">
            â† ãƒãƒ³ã‚¬ä¸€è¦§ã«æˆ»ã‚‹
        </a>
    </p>
</div>

<!-- âœ… ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— -->
<div id="tooltip"
     style="position:absolute; padding:5px; background:white; border:1px solid #ccc; display:none; z-index:10;">
</div>

<!-- âœ… vis-networkæœ¬ä½“ -->
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

<!-- âœ… Djangoã‹ã‚‰JSã¸ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ -->
<script>
    window.mangaNodes = {{ nodes|safe }};
    window.mangaEdges = {{ edges|safe }};
</script>

<!-- âœ… å¤–éƒ¨JS -->
<script src="{% static 'manga/manga_detail.js' %}"></script>
{% endblock %}
