<!DOCTYPE html>
<html>
<head>
    <title>{{ manga.title }}</title>
    <script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>
    <style>
        #network {
            width: 100%;
            height: 600px;
            border: 1px solid lightgray;
        }
    </style>
</head>
<body>
    <h1>{{ manga.title }}</h1>

    <div id="network"></div>

    <script>
        const nodes = new vis.DataSet({{ nodes|safe }});
        const edges = new vis.DataSet({{ edges|safe }});

        const container = document.getElementById("network");
        const data = { nodes, edges };
        const options = {
            layout: {
            hierarchical: {
                enabled: true,
                direction: "UD",          // 上→下
                sortMethod: "directed",
                levelSeparation: 150,     // 縦間隔
                nodeSpacing: 120,         // 横間隔
                blockShifting: false,     // ← レベルをまたいだ微調整を無効
                edgeMinimization: false,  // ← 交差最小化で位置がズレるのを防ぐ
                parentCentralization: false
            }
            },
            physics: { enabled: false },  // 物理演算でのズレを防ぐ
            nodes: {
            shape: "box",
            margin: 10,
            font: { multi: true }
            },
            edges: { arrows: "to" }
        };

        new vis.Network(container, data, options);
    </script>

    <p><a href="{% url 'create_page' manga.id %}">このマンガにページを追加する</a></p>
    <p><a href="{% url 'manga_list' %}">← マンガ一覧に戻る</a></p>
</body>
</html>
