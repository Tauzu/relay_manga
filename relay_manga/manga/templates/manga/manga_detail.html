{% extends "base.html" %}

{% load static %}

{% block title %}{{ manga.title }}{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto">

    <!-- 🏷 タイトル -->
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-3xl font-bold">{{ manga.title }}</h2>
    </div>

    <!-- ✅ 最初のページ追加ボタン（タイトル直下に配置） -->
    {% if manga.pages.count == 0 %}
        <div class="mb-6">
            <a href="{% url 'create_page' manga.id %}" 
               class="inline-flex items-center gap-2 px-4 py-2 rounded bg-green-500 text-white hover:bg-green-600 transition">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                このマンガに最初のページを追加する
            </a>
        </div>
    {% endif %}

    <!-- 🧩 ツリービュー -->
    <div id="network" class="w-full h-[600px] border border-gray-300 rounded"></div>
</div>

<!-- ✅ ツールチップ -->
<div id="tooltip"
     style="position:absolute; padding:5px; background:white; border:1px solid #ccc; display:none; z-index:10;">
</div>

<!-- ✅ vis-network本体の読み込み -->
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

<!-- ✅ DjangoからJSへデータを渡す -->
<script>
    window.mangaNodes = {{ nodes|safe }};
    window.mangaEdges = {{ edges|safe }};
</script>

<!-- ✅ 外部JSファイルの読み込み（最後に！） -->
<script src="{% static 'manga/manga_detail.js' %}"></script>

<!-- 🔙 戻るリンク -->
<p class="mt-6">
    <a href="{% url 'manga_list' %}" class="text-gray-600 hover:underline">
        ← マンガ一覧に戻る
    </a>
</p>
{% endblock %}
