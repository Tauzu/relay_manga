{% extends "base.html" %}
{% load static %}

{% block title %}{{ manga.title }}{% endblock %}

{% block content %}
<!-- âœ… å¤–éƒ¨CSS -->
<link rel="stylesheet" href="{% static 'manga/manga_detail.css' %}">

<style>
    body {
        {% if manga.cover_image %}
            background-image: url("{{ manga.cover_image.url }}");
        {% else %}
            background: linear-gradient(to bottom right, #f9fafb, #e5e7eb);
        {% endif %}
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
        background-repeat: no-repeat;
    }

    /* === ğŸ“± ã‚¹ãƒãƒ›æœ€é©åŒ– === */
    @media (max-width: 640px) {
        .content-overlay {
            padding: 0.75rem !important; /* â† ãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ã‚’å¤§å¹…å‰Šæ¸› */
            border-radius: 0.5rem;
            margin: 0 0.25rem; /* â† ã»ã¼å…¨å¹…ã« */
        }

        #network {
            height: 70vh !important; /* â† é«˜ã•ã‚’èª¿æ•´ã—ã¦åã¾ã‚Šã‚’ã‚ˆã */
            border-width: 1px;
            border-radius: 0.4rem;
        }

        h2.text-3xl {
            font-size: 1.5rem;
        }

        #reset-view {
            top: 6px;
            right: 6px;
            padding: 0.3rem 0.4rem;
        }

        #reset-view svg {
            width: 18px;
            height: 18px;
        }
    }
</style>

<div class="max-w-5xl mx-auto content-overlay">

    <!-- ğŸ· ã‚¿ã‚¤ãƒˆãƒ« -->
    <div class="flex justify-between items-center mb-4">
        <h2 class="text-3xl font-bold text-gray-900">{{ manga.title }}</h2>
    </div>

    <!-- âœ… æœ€åˆã®ãƒšãƒ¼ã‚¸è¿½åŠ ãƒœã‚¿ãƒ³ -->
    {% if manga.pages.count == 0 %}
        <div class="mb-6">
            <a href="{% url 'create_page' manga.id %}" 
               class="inline-flex items-center gap-2 px-4 py-2 rounded bg-green-500 text-white hover:bg-green-600 transition text-sm sm:text-base">
                <svg xmlns="http://www.w3.org/2000/svg" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
                </svg>
                ã“ã®ãƒãƒ³ã‚¬ã«æœ€åˆã®ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ ã™ã‚‹
            </a>
        </div>
    {% endif %}
    
    <!-- ğŸ§© ãƒ„ãƒªãƒ¼ãƒ“ãƒ¥ãƒ¼ -->
    <div id="network-container" class="relative">
        <div id="network" class="w-full h-[600px] border border-gray-300 rounded bg-white/70"></div>

        <!-- ğŸ  ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³ -->
        <button id="reset-view" title="åˆæœŸä½ç½®ã«æˆ»ã‚‹"
            class="absolute top-3 right-3 bg-white/90 hover:bg-gray-100 border border-gray-300 rounded-md p-2 shadow transition">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                      d="M3 12l9-9 9 9M4 10v10h16V10" />
            </svg>
        </button>
    </div>

    <!-- ğŸ”™ æˆ»ã‚‹ãƒªãƒ³ã‚¯ -->
    <p class="mt-6 text-center sm:text-left">
        <a href="{% url 'manga_list' %}" class="text-gray-600 hover:underline">
            â† ãƒãƒ³ã‚¬ä¸€è¦§ã«æˆ»ã‚‹
        </a>
    </p>
</div>

<!-- âœ… ãƒ„ãƒ¼ãƒ«ãƒãƒƒãƒ— -->
<div id="tooltip"
     style="position:absolute; padding:5px; background:white; border:1px solid #ccc; display:none; z-index:10;">
</div>

<!-- âœ… vis-networkæœ¬ä½“ -->
<script src="https://unpkg.com/vis-network/standalone/umd/vis-network.min.js"></script>

<!-- âœ… Djangoã‹ã‚‰JSã¸ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ -->
<script>
    window.mangaNodes = {{ nodes|safe }};
    window.mangaEdges = {{ edges|safe }};
</script>

<!-- âœ… å¤–éƒ¨JS -->
<script src="{% static 'manga/manga_detail.js' %}"></script>
{% endblock %}
