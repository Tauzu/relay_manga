{% extends "base.html" %}
{% load static %}

{% block title %}æ–°ã—ã„ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ {% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto bg-white p-8 rounded-lg shadow">
    <h2 class="text-2xl font-bold text-center mb-8">æ–°ã—ã„ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ </h2>

    <div class="grid grid-cols-2 gap-8">
    <!-- ğŸ”¹ å·¦ã‚«ãƒ©ãƒ ï¼šå‰ã®ãƒšãƒ¼ã‚¸ -->
    <div class="flex flex-col items-center">
        <h3 class="text-lg font-semibold text-gray-700 mb-4">å‰ã®ãƒšãƒ¼ã‚¸</h3>

        <div class="w-[360px] h-[360px] flex items-center justify-center bg-gray-50 border rounded-lg shadow-md overflow-hidden mb-4">
        {% if parent %}
            <img src="{{ parent.image.url }}" alt="è¦ªãƒšãƒ¼ã‚¸" class="object-contain w-full h-full">
        {% else %}
            <span class="text-gray-500">æœ€åˆã®ãƒšãƒ¼ã‚¸ã§ã™</span>
        {% endif %}
        </div>

        {% if parent %}
        <p class="text-gray-600 text-center">{{ parent.display_title }}</p>
        {% else %}
        <p class="text-gray-400 text-center">ã“ã“ã‹ã‚‰ç‰©èªãŒå§‹ã¾ã‚Šã¾ã™</p>
        {% endif %}
    </div>

    <!-- ğŸ”¹ å³ã‚«ãƒ©ãƒ ï¼šæ–°ã—ã„ãƒšãƒ¼ã‚¸ -->
    <div class="flex flex-col items-center">
        <h3 class="text-lg font-semibold text-gray-700 mb-4">æ–°ã—ã„ãƒšãƒ¼ã‚¸</h3>

        <form id="create-form" method="post" enctype="multipart/form-data"
            class="flex flex-col items-center w-[360px]">
        {% csrf_token %}

        <!-- D&Dã‚¨ãƒªã‚¢ -->
        <div id="drop-zone"
                class="w-full h-[360px] border-2 border-dashed border-gray-300 rounded-lg flex flex-col items-center justify-center text-gray-500 hover:border-blue-400 transition overflow-hidden relative mb-4">
            <div id="drop-inner" class="flex flex-col items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="w-10 h-10 mb-2 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16V4m0 0L3 8m4-4l4 4m6 4v12m0 0l4-4m-4 4l-4-4" />
            </svg>
            <p class="text-sm text-gray-500">ã“ã“ã«ç”»åƒã‚’ãƒ‰ãƒ­ãƒƒãƒ—ã¾ãŸã¯ã‚¯ãƒªãƒƒã‚¯ã§é¸æŠ</p>
            </div>
            <input id="id_image" name="image" type="file" accept="image/*" class="hidden">
        </div>

        <!-- ã‚¿ã‚¤ãƒˆãƒ«å…¥åŠ› -->
        <label class="block font-semibold mb-1 text-gray-700 self-start">ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆä»»æ„ï¼‰</label>
        {{ form.title }}

        <!-- ãƒœã‚¿ãƒ³ -->
        <button type="submit"
                class="w-full bg-green-500 text-white py-2 mt-4 rounded font-semibold hover:bg-green-600 transition">
            ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ 
        </button>
        </form>
    </div>
    </div>

    <!-- ğŸ”¹ ãƒ“ãƒ¥ãƒ¼ã‚¢ã«æˆ»ã‚‹ï¼ˆå·¦å¯„ã›ï¼‰ -->
    {% if parent %}
    <div class="mt-8">
    <a href="{% url 'page_viewer' parent.id %}"
        class="text-gray-600 hover:text-blue-600 hover:underline transition">
        â† ãƒ“ãƒ¥ãƒ¼ã‚¢ã«æˆ»ã‚‹
    </a>
    </div>
    {% endif %}
</div>

<!-- âœ… ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼JS -->
<script>
document.addEventListener("DOMContentLoaded", () => {
    const dropZone = document.getElementById("drop-zone");
    const inputFile = document.getElementById("id_image");
    const dropInner = document.getElementById("drop-inner");

    dropZone.addEventListener("click", () => inputFile.click());
    dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("border-blue-400", "bg-blue-50");
    });
    dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("border-blue-400", "bg-blue-50");
    });
    dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("border-blue-400", "bg-blue-50");
        const file = e.dataTransfer.files[0];
        if (file) {
        inputFile.files = e.dataTransfer.files;
        showPreview(file);
        }
    });
    inputFile.addEventListener("change", (e) => {
        const file = e.target.files[0];
        if (file) showPreview(file);
    });

    function showPreview(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
        dropInner.innerHTML = `<img src="${e.target.result}" class="object-contain w-full h-full" alt="ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒ">`;
        };
        reader.readAsDataURL(file);
    }
});
</script>
{% endblock %}
